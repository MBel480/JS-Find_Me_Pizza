<!DOCTYPE html>

<html>
	<head>

		<link rel="stylesheet" href="locator.css">

	</head>

	<body>

		<div id="map"></div>

		<div id="latLng">
			<form action="">
				<fieldset>

					<label>Map Latitude:</label>
					<input type="text" id="lat"/>
					<label>Map Longitude:</label>
					<input type="text" id="lng"/>
					<label>Marker Latitude:</label>
					<input type="text" id="marklat">
					<label>Marker Longitude:</label>
					<input type="text" id="marklng">

				</fieldset>
			</form>
		</div>

		<div id="radius">
			<form action="">
				<fieldset>
					<label>Search Radius</label>
					<input type="text" id="rad_input">
				</fieldset>
			</form>
		</div>

			<script>

				var mainMap,
					mapMarkers = [],
					searchRadii = [],
					coordDecimals = 7;

				function initMap() {

					/*============================
					Map centered on Washington, D.C.
					with main map controls active
					==============================*/

					var sanFrancisco = {lat: 37.773972, lng: -122.431297},
						mapDiv = document.getElementById('map');

					var mapOptions = {

					center: {lat: 38.889931, lng: -77.009003},

					zoom: 8,

					zoomControl: true,

					mapTypeControl: true,

					scaleControl: true,

					streetViewControl: true,

					mapTypeId: google.maps.MapTypeId.HYBRID
		
					};

					mainMap = new google.maps.Map(mapDiv, mapOptions);

					document.getElementById("lat").value = mapOptions['center']['lat'];
					document.getElementById("lng").value = mapOptions['center']['lng'];

					/*============================
					Map center change displays
					latitude and longitude
					==============================*/

					google.maps.event.addListener(mainMap, "center_changed", function() {

						// var latitude = event.latLng.lat(),
						// 	longitude = event.latLng.lng(),
						var latOutput = document.getElementById("lat"),
						lngOutput = document.getElementById("lng");

						latOutput.value = mainMap.getCenter().lat().toFixed(coordDecimals);
						lngOutput.value = mainMap.getCenter().lng().toFixed(coordDecimals);

					});

					locationMarker = new google.maps.Marker({
							map: mainMap,
							draggable: true,
							position: mainMap.getCenter()
						});

					locationMarker.setMap(mainMap);
					mapMarkers.push(locationMarker);

					/*============================
					Marker position change displays
					latitude and longitude
					==============================*/
					
					document.getElementById("marklat").value = mapOptions['center']['lat'];
					document.getElementById("marklng").value = mapOptions['center']['lng'];	

					google.maps.event.addListener(locationMarker, "drag", function() {

						document.getElementById("marklat").value = 
						locationMarker.getPosition().lat().toFixed(coordDecimals);

						document.getElementById("marklng").value = 
						locationMarker.getPosition().lng().toFixed(coordDecimals);

					});

					/*============================
					Marker terminal position displays
					search radius
					==============================*/

					google.maps.event.addListener(locationMarker, "dragend", function() {

						if (searchRadii.length !== 0) {

							removeFromMap(searchRadii);
							searchRadii = [];

						}

						var searchRadius = new google.maps.Circle({

							map: mainMap,
							radius: milesToMeters(document.getElementById("rad_input").value),
							fillColor: '#AA0000'

						});

						searchRadii.push(searchRadius);
						searchRadius.bindTo('center', locationMarker, 'position');

					});

					/*============================
					Center map using geolocation 
					(if supported by browser)
					==============================*/
					getCurrentLocation();

				};

				function getCurrentLocation() {

					if (navigator.geolocation) {

						navigator.geolocation.getCurrentPosition(showPosition);

					}else {

					
						alert("Geolocation not supported by browser; centering map on San Francisco ");

						mainMap.setCenter(sanFrancisco);

					}
				};

				function showPosition(position) {

					var presentLocation = new google.maps.LatLng(position.coords.latitude,
						position.coords.longitude);

					mainMap.setCenter(presentLocation);
				};

				function removeFromMap(itemArray) {
					
					var i = 0;

					for(i = 0; i < itemArray.length; i++) {

						itemArray[i].setMap(null);

					}
				};

				function milesToMeters(radius) {

					return radius * 5280 * 0.3048;

				};

			</script>

			<script src='locator.js?onload=initialize'></script>

			<script asyn defer
				src="https://maps.googleapis.com/maps/api/js?ey=AIzaSyAmrQjhfl2vtd_xRE8VQdF-C5z-SncAev0&callback=initMap"
			></script>

	</body>

</html>